<script type="text/javascript">

 $(document).ready(function(){
    $("select#packagetype").change(function(){
        let value = $(this).children("option:selected").val();
		if(value==2)  { // company
			$('#companygrid').show();
			$('#customergrid').hide();
			$("input[name='packages_0_customerid']").val('');
			$("input[name='packages_0_fullname']").val('');
		}
		else if(value==3) { //customer
			$('#companygrid').hide();
			$('#customergrid').show();
			$("input[name='packages_0_companyid']").val('');
			$("input[name='packages_0_companyname']").val('');
		}
		else if(value==4) { // customer and company
			$('#companygrid').show();
			$('#customergrid').show();
		}
		else { // hide
			$('#companygrid').hide();
			$('#customergrid').hide();
			$('#packages_0_companyid').val('');
			$('#packages_0_customerid').val('');
			
		}
    });
});
function getClick(){

}	
function getmulticompany()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/getmulticompany')?>',
		'data':{
			'companyid':$("input[name='multicompanyid']").val(),
			'packageid':$("input[name='packages_0_packageid']").val(),
			},
		'type':'post','dataType':'json',
		'success':function(data) {
			if(data.status=='success') {
				//$.fn.yiiGridView.update("TtntdetailList");
				console.log('success');
				$("textarea[name='companies']").val(data.companyname);
				$("input[name='companyid']").val(data.companyid);
			}
			else {
				toastr.error('error');	
			}
		},
		'cache':false});
}
    
function cancelmulticompany()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/cancelmulticompany')?>',
		'data':{
			'companyid':$("input[name='multicompanyid']").val(),
			'packageid':$("input[name='packages_0_packageid']").val(),
			},
		'type':'post','dataType':'json',
		'success':function(data) {
			if(data.status=='success') {
				//$.fn.yiiGridView.update("TtntdetailList");
				console.log('success');
                toastr.info('<?php echo $this->getCatalog('alreadysaved')?>');
				$("textarea[name='companies']").val(data.companyname);
				$("#companyid").val(data.multicompanyid).val();
			}
			else {
				toastr.error('error');	
			}
		},
		'cache':false});
}
	
function getmulticustomer()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/getmulticustomer')?>',
		'data':{
			'customerid':$("input[name='multicustomerid']").val(),
			'packageid':$("input[name='packages_0_packageid']").val(),
			},
		'type':'post','dataType':'json',
		'success':function(data) {
			if(data.status=='success') {
				//$.fn.yiiGridView.update("TtntdetailList");
				console.log('success');
				$("textarea[name='customers']").val(data.fullname);
				$("input[name='customerid']").val(data.customerid);
			}
			else {
				toastr.error('error');	
			}
		},
		'cache':false});
}

function cancelmulticustomer()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/cancelmulticustomer')?>',
		'data':{
			'customerid':$("input[name='multicustomerid']").val(),
			'packageid':$("input[name='packages_0_packageid']").val(),
			},
		'type':'post','dataType':'json',
		'success':function(data) {
			if(data.status=='success') {
				//$.fn.yiiGridView.update("TtntdetailList");
				console.log('success');
                toastr.info('<?php echo $this->getCatalog('alreadysaved')?>');
				$("textarea[name='customers']").val(data.fullname);
				$("#customerid").val(data.multicustomer).val();
			}
			else {
				toastr.error('error');	
			}
		},
		'cache':false});
}
	
function getproductdata() {
	jQuery.ajax({
		'url': '<?php echo Yii::app()->createUrl('common/productplant/getproductplant')?>',
		'data': {
						'productid':$("input[name='packagedetail_1_productid']").val(),
						'companyid':0,
                        'type':'soheader',
		},
		'type': 'post',
		'dataType': 'json',
		'success': function(data) {
		if (data.status == "success")
			{
				$("input[name='packagedetail_1_unitofmeasureid']").val(data.uomid);
				$("input[name='packagedetail_1_uomcode']").val(data.uomcode);
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache': false
	});
	return false;
}
	
function savecompany() {
	let value = $("#companyid").val();
	let companyid = $("input[name='packages_0_companyid']").val();
	if(value != '') {
		let newValue = value+','+companyid;
		$("#companyid").val(newValue);
		//console.log(newValue);	
	}
	else {
		$('#companyid').val(companyid);
	}
	let companies = $('#companyid').val();
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/getCompanies')?>','data':{'companies' : companies},
				 'type':'post','dataType':'json',
				 'success':function(data) {
					 if(data.status == 'success') {
						 $("textarea[name='companies']").val(data.companyname);
						 $("input[name='packages_0_companyname']").val('');
					 } else {
						console.log(data);
						toastr.error('error'); 
					 }
				 }
		
	});
}
function newdata()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/create')?>','data':{},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$("input[name='packages_0_packageid']").val(data.packageid);
				$("input[name='packages_0_docno']").val('');
				$("input[name='packages_0_packagename']").val('');
				$("input[name='packages_0_companyid']").val('');
				$("input[name='companyid']").val(''),
				$("input[name='customerid']").val(''),
				$("input[name='packages_0_docdate']").val(data.docdate);
				$("input[name='packages_0_customerid']").val('');
				$("input[name='packages_0_paymentmethodid']").val('');
				$("input[name='packages_0_paycode']").val('');
				$("input[name='packages_0_startdate']").val(data.startdate);
				$("input[name='packages_0_enddate']").val(data.enddate);
				$("textarea[name='packages_0_headernote']").val('');
				$("input[name='packages_0_recordstatus']").val(data.recordstatus);
				$("input[name='packages_0_statusname']").val('');
				$("input[name='packages_0_companyname']").val('');
				$("input[name='packages_0_fullname']").val('');
				$.fn.yiiGridView.update('packagedetailList',{data:{'packageid':data.packageid}});
				$.fn.yiiGridView.update('packagediscList',{data:{'packageid':data.packageid}});
				$('#InputDialog').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}
function newdatapackagedetail()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/createpackagedetail')?>','data':{},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$("input[name='packagedetail_1_packagedetailid']").val('');
				$("input[name='packagedetail_1_productid']").val('');
				$("input[name='packagedetail_1_qty']").val(data.qty);
				$("input[name='packagedetail_1_unitofmeasureid']").val('');
				$("input[name='packagedetail_1_price']").val(data.price);
				$("input[name='packagedetail_1_productname']").val('');
				$("input[name='packagedetail_1_uomcode']").val('');
				$("input[name='packagedetail_1_isbonus']").val('');
				$('#InputDialogpackagedetail').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}
function newdatapackagedisc()
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/createpackagedisc')?>','data':{},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
			$("input[name='packagedisc_2_packagediscid']").val('');
      $("input[name='packagedisc_2_discvalue']").val(data.discvalue);
			$('#InputDialogpackagedisc').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}

function updatedata($id)
{	
	//$("select#packagetype > [value=4]").attr("selected", "true");
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/update')?>','data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$("input[name='packages_0_packageid']").val(data.packageid);
				$("input[name='packages_0_docno']").val(data.docno);
				$("input[name='packages_0_packagename']").val(data.packagename);
				$("select[name='packagetype']").val(data.packagetype);
				$("input[name='packages_0_companyid']").val(data.companyid);
				$("input[name='packages_0_docdate']").val(data.docdate);
				$("input[name='packages_0_customerid']").val(data.customerid);
				$("input[name='packages_0_paymentmethodid']").val(data.paymentmethodid);
				$("input[name='packages_0_paycode']").val(data.paycode);
				$("input[name='packages_0_startdate']").val(data.startdate);
				$("input[name='packages_0_enddate']").val(data.enddate);
				$("textarea[name='packages_0_headernote']").val(data.headernote);
				$("textarea[name='companies']").val(data.companies);
				$("input[name='companyid']").val(data.companyid);
				$("textarea[name='customers']").val(data.customers);
				$("input[name='customerid']").val(data.customerid);
				$("input[name='packages_0_recordstatus']").val(data.recordstatus);
				$("input[name='packages_0_statusname']").val(data.statusname);
				$("input[name='packages_0_companyname']").val(data.companyname);
				$("input[name='packages_0_fullname']").val(data.fullname);
				//console.log(data);
				
				console.log(data.packagetype);
				let packagetype = data.packagetype;
				if(packagetype == 2) {
					$('#companygrid').show();
					$('#customergrid').hide();
					$("input[name='packages_0_customerid']").val('');
					$("input[name='packages_0_fullname']").val('');	
				}
				else if(packagetype == 3) {
					$('#companygrid').hide();
					$('#customergrid').show();
					$("input[name='packages_0_companyid']").val('');
					$("input[name='packages_0_companyname']").val('');
				}
				else if(packagetype == 4) {
					$('#companygrid').show();
					$('#customergrid').show();
				}
				
				$.fn.yiiGridView.update('packagedetailList',{data:{'packageid':data.packageid}});
				$.fn.yiiGridView.update('packagediscList',{data:{'packageid':data.packageid}});
				
				$('#InputDialog').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}
function updatedatapackagedetail($id)
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/updatepackagedetail')?>','data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				if (data.isbonus == 1)
                {
                    $("input[name='packagedetail_1_isbonus']").prop('checked',true);
                }
                else
                {
                    $("input[name='packagedetail_1_isbonus']").prop('checked',false)
                }
                $("input[name='packagedetail_1_packagedetailid']").val(data.packagedetailid);
				$("input[name='packagedetail_1_productid']").val(data.productid);
				$("input[name='packagedetail_1_qty']").val(data.qty);
				$("input[name='packagedetail_1_unitofmeasureid']").val(data.unitofmeasureid);
				$("input[name='packagedetail_1_price']").val(data.price);
				$("input[name='packagedetail_1_productname']").val(data.productname);
				$("input[name='packagedetail_1_uomcode']").val(data.uomcode);
				$('#InputDialogpackagedetail').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}
function updatedatapackagedisc($id)
{
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/updatepackagedisc')?>','data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$("input[name='packagedisc_2_packagediscid']").val(data.packagediscid);
				$("input[name='packagedisc_2_discvalue']").val(data.discvalue);
				$('#InputDialogpackagedisc').modal();
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	return false;
}

function savedata()
{	
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/save')?>',
		'data':{
			'packageid':$("input[name='packages_0_packageid']").val(),
      'packagename':$("input[name='packages_0_packagename']").val(),
      'packagetype':$("#packagetype").val(),
      'companyid':$("input[name='companyid']").val(),
      'docdate':$("input[name='packages_0_docdate']").val(),
      'customerid':$("input[name='customerid']").val(),
      'paymentmethodid':$("input[name='packages_0_paymentmethodid']").val(),
      'startdate':$("input[name='packages_0_startdate']").val(),
      'enddate':$("input[name='packages_0_enddate']").val(),
      'headernote':$("textarea[name='packages_0_headernote']").val(),
		},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$('#InputDialog').modal('hide');
				toastr.info(data.div);
				$.fn.yiiGridView.update("GridList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
}

function savedatapackagedetail()
{
    var isbonus = 0;
	if ($("input[name='packagedetail_1_isbonus']").prop('checked'))
	{
		isbonus = 1;
	}
	else
	{
		isbonus = 0;
	}
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/savepackagedetail')?>',
		'data':{
			'packageid':$("input[name='packages_0_packageid']").val(),
			'packagedetailid':$("input[name='packagedetail_1_packagedetailid']").val(),
      'productid':$("input[name='packagedetail_1_productid']").val(),
      'qty':$("input[name='packagedetail_1_qty']").val(),
      'unitofmeasureid':$("input[name='packagedetail_1_unitofmeasureid']").val(),
      'price':$("input[name='packagedetail_1_price']").val(),
      'isbonus':isbonus,
		},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$('#InputDialogpackagedetail').modal('hide');
				toastr.info(data.div);
				$.fn.yiiGridView.update("packagedetailList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
}

function savedatapackagedisc()
{

	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/savepackagedisc')?>',
		'data':{
			'packageid':$("input[name='packages_0_packageid']").val(),
			'packagediscid':$("input[name='packagedisc_2_packagediscid']").val(),
      'discvalue':$("input[name='packagedisc_2_discvalue']").val(),
		},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				$('#InputDialogpackagedisc').modal('hide');
				toastr.info(data.div);
				$.fn.yiiGridView.update("packagediscList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
}

function approvedata($id)
{
	$.msg.confirmation('Confirm','<?php echo $this->getCatalog('areyousure')?>',function(){	
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/approve')?>',
		'data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				toastr.info(data.div);
				$.fn.yiiGridView.update("GridList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});	});
	return false;
}
function deletedata($id)
{
	$.msg.confirmation('Confirm','<?php echo $this->getCatalog('areyousure')?>',function(){	
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/delete')?>',
		'data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				toastr.info(data.div);
				$.fn.yiiGridView.update("GridList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
	'cache':false});});
	return false;
}

function purgedata($id)
{
	$.msg.confirmation('Confirm','<?php echo $this->getCatalog('areyousure')?>',function(){
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/purge')?>','data':{'id':$id},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				toastr.info(data.div);
				$.fn.yiiGridView.update("GridList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	});
	return false;
}
function purgedatapackagedetail()
{
	$.msg.confirmation('Confirm','<?php echo $this->getCatalog('areyousure')?>',function(){
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/purgepackagedetail')?>','data':{'id':$.fn.yiiGridView.getSelection("packagedetailList")},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				toastr.info(data.div);
				$.fn.yiiGridView.update("packagedetailList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	});
	return false;
}
function purgedatapackagedisc()
{
	$.msg.confirmation('Confirm','<?php echo $this->getCatalog('areyousure')?>',function(){
	jQuery.ajax({'url':'<?php echo Yii::app()->createUrl('order/packages/purgepackagedisc')?>','data':{'id':$.fn.yiiGridView.getSelection("packagediscList")},
		'type':'post','dataType':'json',
		'success':function(data) {
			if (data.status == "success")
			{
				toastr.info(data.div);
				$.fn.yiiGridView.update("packagediscList");
			}
			else
			{
				toastr.error(data.div);
			}
		},
		'cache':false});
	});
	return false;
}

function searchdata($id=0)
{
	$('#SearchDialog').modal('hide');
	var array = 'packages_0_packageid='+$id
+ '&docno='+$("input[name='dlg_search_docno']").val()
+ '&packagename='+$("input[name='dlg_search_packagename']").val()
+ '&companyname='+$("input[name='dlg_search_companyname']").val()
+ '&fullname='+$("input[name='dlg_search_fullname']").val();
	$.fn.yiiGridView.update("GridList",{data:array});
	return false;
}

function downpdf($id=0) {
	var array = 'packages_0_packageid='+$id
+ '&docno='+$("input[name='dlg_search_docno']").val()
+ '&packagename='+$("input[name='dlg_search_packagename']").val()
+ '&companyname='+$("input[name='dlg_search_companyname']").val()
+ '&fullname='+$("input[name='dlg_search_fullname']").val();
	window.open('<?php echo Yii::app()->createUrl('Order/packages/downpdf')?>?'+array);
}

function downxls($id=0) {
	var array = 'packages_0_packageid='+$id
+ '&docno='+$("input[name='dlg_search_docno']").val()
+ '&packagename='+$("input[name='dlg_search_packagename']").val()
+ '&companyname='+$("input[name='dlg_search_companyname']").val()
+ '&fullname='+$("input[name='dlg_search_fullname']").val();
	window.open('<?php echo Yii::app()->createUrl('Order/packages/downxls')?>?'+array);
}

function GetDetail($id)
{
	$('#ShowDetailDialog').modal('show');
	var array = 'packageid='+$id
$.fn.yiiGridView.update("DetailpackagedetailList",{data:array});
$.fn.yiiGridView.update("DetailpackagediscList",{data:array});
}

function GetDetailData($id)
{
	$('#ShowDetailDataDialog').modal('show');
	var array = 'packageid='+$id
$.fn.yiiGridView.update("DetailcompanyList",{data:array});
$.fn.yiiGridView.update("DetailcustomerList",{data:array});
}
</script>
<h3><?php echo $this->getCatalog('packages') ?></h3>
<?php if ($this->checkAccess('packages','iswrite')) { ?>
<button name="CreateButton" type="button" class="btn btn-primary" onclick="newdata()"><?php echo $this->getCatalog('new')?></button>
<?php } ?>
<?php if ($this->checkAccess('packages','ispost')) { ?>
<button name="ApproveButton" type="button" class="btn btn-success" onclick="approvedata($.fn.yiiGridView.getSelection('GridList'))"><?php echo $this->getCatalog('approve')?></button>
<?php } ?>
<?php if ($this->checkAccess('packages','isreject')) { ?>
<button name="DeleteButton" type="button" class="btn btn-warning" onclick="deletedata($.fn.yiiGridView.getSelection('GridList'))"><?php echo $this->getCatalog('reject')?></button>
<?php } ?>
<?php if ($this->checkAccess('packages','ispurge')) { ?>
<button name="PurgeButton" type="button" class="btn btn-danger" onclick="purgedata($.fn.yiiGridView.getSelection('GridList'))"><?php echo $this->getCatalog('purge')?></button>
<?php } ?>
<button name="SearchButton" type="button" class="btn btn-success" data-toggle="modal" data-target="#SearchDialog"><?php echo $this->getCatalog('search')?></button>
<?php if ($this->checkAccess('packages','isdownload')) { ?>
  <div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
    <?php echo $this->getCatalog('download')?> <span class="caret"></span></button>
    <ul class="dropdown-menu" role="menu">
      <li><a onclick="downpdf($.fn.yiiGridView.getSelection('GridList'))"><?php echo $this->getCatalog('downpdf')?></a></li>
      <li><a onclick="downxls($.fn.yiiGridView.getSelection('GridList'))"><?php echo $this->getCatalog('downxls')?></a></li>
    </ul>
  </div>
<?php } ?>

<?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataProvider,
		'id'=>'GridList',
		'selectableRows'=>2,
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
				'class'=>'CCheckBoxColumn',
				'id'=>'ids',
				'htmlOptions' => array('style'=>'width:10px'),
			),
			array
			(
				'class'=>'CButtonColumn',
				'template'=>'{select} {edit} {purge} {pdf}',
				'htmlOptions' => array('style'=>'width:100px'),
				'buttons'=>array
				(
					'select' => array
					(
							'label'=>$this->getCatalog('detail'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/detail.png',
							'url'=>'"#"',
							'click'=>"function() { 
								GetDetail($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
					'edit' => array
					(
							'label'=>$this->getCatalog('edit'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/edit.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','iswrite')),							
							'url'=>'"#"',
							'click'=>"function() { 
								updatedata($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
					'purge' => array
					(
							'label'=>$this->getCatalog('purge'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/trash.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','ispurge')),							
							'url'=>'"#"',
							'click'=>"function() { 
								purgedata($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
					'pdf' => array
					(
							'label'=>$this->getCatalog('downpdf'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/pdf.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','isdownload')),
							'url'=>'"#"',
							'click'=>"function() { 
								downpdf($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
				),
			),
array(
					'header'=>$this->getCatalog('packageid'),
					'name'=>'packageid',
					'value'=>'$data["packageid"]'
				),
							array(
					'header'=>$this->getCatalog('docdate'),
					'name'=>'docdate',
					'value'=>'Yii::app()->format->formatDate($data["docdate"])'
				),
							array(
					'header'=>$this->getCatalog('docno'),
					'name'=>'docno',
					'value'=>'$data["docno"]'
				),
							array(
					'header'=>$this->getCatalog('packagename'),
					'name'=>'packagename',
					'value'=>'$data["packagename"]'
				),
							array(
					'header'=>$this->getCatalog('packagetype'),
					'name'=>'packagetype',
					'value'=>'$data["packagetypename"]',
					
				),
                            array(
                    'header'=>$this->getCatalog('paycode'),
                    'name'=>'paymentmethodid',
                    'value'=>'$data["paycode"]'
                ),
					array
				(
					'class'=>'CButtonColumn',
					'header'=>$this->getCatalog('Data'),
					'template'=>'{company}',
					'htmlOptions' => array('style'=>'width:100px'),
					'buttons'=>array
					(
						'company' => array
						(
								'label'=>$this->getCatalog('Lihat Data'),
								'imageUrl'=>Yii::app()->baseUrl.'/images/task.png',
								'url'=>'"#"',
								'click'=>"function() { 
									GetDetailData($(this).parent().parent().children(':nth-child(3)').text());
								}",
						),
					),
				),
							array(
					'header'=>$this->getCatalog('startdate'),
					'name'=>'startdate',
					'value'=>'Yii::app()->format->formatDate($data["startdate"])'
				),
							array(
					'header'=>$this->getCatalog('enddate'),
					'name'=>'enddate',
					'value'=>'Yii::app()->format->formatDate($data["enddate"])'
				),
							array(
					'header'=>$this->getCatalog('headernote'),
					'name'=>'headernote',
					'value'=>'$data["headernote"]'
				),
							array(
					'header'=>$this->getCatalog('recordstatus'),
					'name'=>'statusname',
					'value'=>'$data["statusname"]'
				),
							
		)
));
?>
<div id="SearchDialog" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><?php echo $this->getCatalog('search') ?></h4>
      </div>
				<div class="modal-body">
					<div class="form-group">
						<label for="dlg_search_docno"><?php echo $this->getCatalog('docno')?></label>
						<input type="text" class="form-control" name="dlg_search_docno">
					</div>
          <div class="form-group">
						<label for="dlg_search_packagename"><?php echo $this->getCatalog('packagename')?></label>
						<input type="text" class="form-control" name="dlg_search_packagename">
					</div>
          <div class="form-group">
						<label for="dlg_search_companyname"><?php echo $this->getCatalog('companyname')?></label>
						<input type="text" class="form-control" name="dlg_search_companyname">
					</div>
          <div class="form-group">
						<label for="dlg_search_fullname"><?php echo $this->getCatalog('fullname')?></label>
						<input type="text" class="form-control" name="dlg_search_fullname">
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success" onclick="searchdata()"><?php echo $this->getCatalog('search')?></button>
					<button type="button" class="btn btn-default" data-dismiss="modal"><?php echo $this->getCatalog('close')?></button>
				</div>
		</div>
	</div>
</div>
<div id="InputDialog" class="modal fade" role="dialog">
	<div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><?php echo $this->getCatalog('packages') ?></h4>
      </div>
      <div class="modal-body">
				<input type="hidden" class="form-control" name="packages_0_packageid">
							
		<div class="row">
						<div class="col-md-4">
							<label for="packages_0_docdate"><?php echo $this->getCatalog('docdate')?></label>
						</div>
						<div class="col-md-8">
							<input type="date" class="form-control" name="packages_0_docdate">
						</div>
					</div>
		  
	  	<div class="row">
						<div class="col-md-4">
							<label for="packages_0_packagename"><?php echo $this->getCatalog('packagename')?></label>
						</div>
						<div class="col-md-8">
							<input type="text" class="form-control" name="packages_0_packagename">
						</div>
					</div>
		 <div class="row">
		 	<div class="col-md-4">
				<label for="packages_0_packagestype"><?php echo $this->getCatalog('packagestype')?></label> 
		 	</div>
			 <div class="col-md-8">
				<select class="form-control custom-select" id="packagetype" name="packagetype">
				  <option><?php echo getCatalog('packagetype')?></option>
					<?php $i=1; foreach($packagetype as $row) : ?>
						<?php if($i==4) : ?>
						<option value=<?= $i;?>><?= $row;?></option>
						<?php else : ?>
						<option value=<?= $i;?> ><?= $row;?></option>
						<?php endif; ?>
					<?php $i++; endforeach; ?>
				</select>
			 </div>
		 </div> 
							
		 <div id="companygrid" style="display:none">
		 <div class="row">
		 	<div class="col-md-4">
			 <label for="packages_0_companyid"><?= getCatalog('company')?></label>
		 	</div>
		<div class="col-md-8">
        <?php $this->widget('DataPopUp',
						array('id'=>'Widget','IDField'=>'multicompanyid','ColField'=>'multicompanyname',
							'IDDialog'=>'multi_company_dialog','titledialog'=>$this->getCatalog('multicompany'),'classtype'=>'col-md-4',
							'classtypebox'=>'col-md-8',
							'PopUpName'=>'admin.components.views.MultiCompanyPopUp','PopGrid'=>'multicompanygrid',
                            'RelationID'=>'packages_0_packageid','onaftersign'=>'getmulticompany();')); 
					?>
		</div>
		</div>
			 <div class="col-md-4"></div>
			 <div class="col-md-8">
				<textarea type="text" class="form-control" rows="5" name="companies"></textarea>
                 <input type="hidden" name="companyid" id="companyid" value="" />
			</div>
		</div>
        
		<div id="customergrid" style="display:none">
		 <div class="row">
		 	<div class="col-md-4">
			 <label for="packages_0_customerid"><?= getCatalog('customer')?></label>
		 	</div>
		<div class="col-md-8">
        <?php $this->widget('DataPopUp',
						array('id'=>'Widget','IDField'=>'multicustomerid','ColField'=>'multifullname',
							'IDDialog'=>'multi_customer_dialog','titledialog'=>$this->getCatalog('multicustomer'),'classtype'=>'col-md-4',
							'classtypebox'=>'col-md-8',
							'PopUpName'=>'common.components.views.MultiCustomerPopUp','PopGrid'=>'multicustomerrid',
                            'RelationID'=>'packages_0_packageid','onaftersign'=>'getmulticustomer();')); 
					?>
		</div>
		</div>
			 <div class="col-md-4"></div>
			 <div class="col-md-8">
				<textarea type="text" class="form-control" rows="5" name="customers"></textarea>
                 <input type="hidden" name="customerid" id="customerid" value="" />
			</div>
		</div>
		  
		<!--<div id="customergrid" style="display:none">
        <?php /*$this->widget('DataPopUp',
				array('id'=>'Widget','IDField'=>'packages_0_customerid','ColField'=>'packages_0_fullname',
					'IDDialog'=>'packages_0_customerid_dialog','titledialog'=>$this->getCatalog('customer'),'classtype'=>'col-md-4',
					'classtypebox'=>'col-md-8',
					'PopUpName'=>'common.components.views.CustomerPopUp','PopGrid'=>'packages_0_customeridgrid',
					'onaftersign'=>'savecustomer()')); 
			*/ ?>
	 	</div>-->
        <?php $this->widget('DataPopUp',
				array('id'=>'Widget','IDField'=>'packages_0_paymentmethodid','ColField'=>'packages_0_paycode',
					'IDDialog'=>'packages_0_paymentmethodid_dialog','titledialog'=>$this->getCatalog('paymentmethod'),'classtype'=>'col-md-4',
					'classtypebox'=>'col-md-8',
					'PopUpName'=>'common.components.views.PaymentmethodPopUp','PopGrid'=>'packages_0_paymentmethodidgrid')); 
			?>
        <div class="row">
						<div class="col-md-4">
							<label for="packages_0_startdate"><?php echo $this->getCatalog('startdate')?></label>
						</div>
						<div class="col-md-8">
							<input type="date" class="form-control" name="packages_0_startdate">
						</div>
					</div>
							
        <div class="row">
						<div class="col-md-4">
							<label for="packages_0_enddate"><?php echo $this->getCatalog('enddate')?></label>
						</div>
						<div class="col-md-8">
							<input type="date" class="form-control" name="packages_0_enddate">
						</div>
					</div>
							
        <div class="row">
						<div class="col-md-4">
							<label for="packages_0_headernote"><?php echo $this->getCatalog('headernote')?></label>
						</div>
						<div class="col-md-8">
							<textarea type="text" class="form-control" rows="5" name="packages_0_headernote"></textarea>
						</div>
					</div>
							
				<ul class="nav nav-tabs">
				<li><a data-toggle="tab" href="#packagedetail"><?php echo $this->getCatalog("packagedetail")?></a></li>
<li><a data-toggle="tab" href="#packagedisc"><?php echo $this->getCatalog("packagedisc")?></a></li>

				</ul>
				<div class="tab-content">
				
<div id="packagedetail" class="tab-pane">
	<?php if ($this->checkAccess('packages','iswrite')) { ?>
<button name="CreateButtonpackagedetail" type="button" class="btn btn-primary" onclick="newdatapackagedetail()"><?php echo $this->getCatalog('new')?></button>
<button name="PurgeButtonpackagedetail" type="button" class="btn btn-danger" onclick="purgedatapackagedetail()"><?php echo $this->getCatalog('purge')?></button>
<?php } ?>
    <?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataProviderpackagedetail,
		'id'=>'packagedetailList',
		'selectableRows'=>2,
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
				'class'=>'CCheckBoxColumn',
				'id'=>'ids',
			),
			array
			(
				'class'=>'CButtonColumn',
				'template'=>'{edit} {purge}',
				'htmlOptions' => array('style'=>'width:160px'),
				'buttons'=>array
				(
					'edit' => array
					(
							'label'=>$this->getCatalog('edit'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/edit.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','iswrite')),							
							'url'=>'"#"',
							'click'=>"function() { 
								updatedatapackagedetail($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
					'purge' => array
					(
							'label'=>$this->getCatalog('purge'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/trash.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','iswrite')),							
							'url'=>'"#"',
							'click'=>"function() { 
								purgedatapackagedetail($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
				),
			),

			array(
					'header'=>$this->getCatalog('packagedetailid'),
					'name'=>'packagedetailid',
					'value'=>'$data["packagedetailid"]'
				),
							array(
					'header'=>$this->getCatalog('product'),
					'name'=>'productid',
					'value'=>'$data["productname"]'
				),
							array(
					'header'=>$this->getCatalog('qty'),
					'name'=>'qty',
					'value'=>'Yii::app()->format->formatNumber($data["qty"])'
				),
							array(
					'header'=>$this->getCatalog('unitofmeasure'),
					'name'=>'unitofmeasureid',
					'value'=>'$data["uomcode"]'
				),
							array(
					'header'=>$this->getCatalog('price'),
					'name'=>'price',
					'value'=>'Yii::app()->format->formatNumber($data["price"])'
				),
                			array(
                	'class'=>'CCheckBoxColumn',
                	'name'=>'isbonus',
                	'header'=>$this->getCatalog('isbonus?'),
                	'selectableRows'=>'0',
                	'checked'=>'$data["isbonus"]',
                ),			
		)
));
?>
  </div>
<div id="packagedisc" class="tab-pane">
	<?php if ($this->checkAccess('packages','iswrite')) { ?>
<button name="CreateButtonpackagedisc" type="button" class="btn btn-primary" onclick="newdatapackagedisc()"><?php echo $this->getCatalog('new')?></button>
<button name="PurgeButtonpackagedisc" type="button" class="btn btn-danger" onclick="purgedatapackagedisc()"><?php echo $this->getCatalog('purge')?></button>
<?php } ?>
    <?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataProviderpackagedisc,
		'id'=>'packagediscList',
		'selectableRows'=>2,
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
				'class'=>'CCheckBoxColumn',
				'id'=>'ids',
			),
			array
			(
				'class'=>'CButtonColumn',
				'template'=>'{edit} {purge}',
				'htmlOptions' => array('style'=>'width:160px'),
				'buttons'=>array
				(
					'edit' => array
					(
							'label'=>$this->getCatalog('edit'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/edit.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','iswrite')),							
							'url'=>'"#"',
							'click'=>"function() { 
								updatedatapackagedisc($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
					'purge' => array
					(
							'label'=>$this->getCatalog('purge'),
							'imageUrl'=>Yii::app()->baseUrl.'/images/trash.png',
							'visible'=>$this->booltostr($this->checkAccess('packages','iswrite')),							
							'url'=>'"#"',
							'click'=>"function() { 
								purgedatapackagedisc($(this).parent().parent().children(':nth-child(3)').text());
							}",
					),
				),
			),

			array(
					'header'=>$this->getCatalog('packagediscid'),
					'name'=>'packagediscid',
					'value'=>'$data["packagediscid"]'
				),
							array(
					'header'=>$this->getCatalog('discvalue'),
					'name'=>'discvalue',
					'value'=>'Yii::app()->format->formatNumber($data["discvalue"])'
				),
							
		)
));
?>
  </div>
				</div>
      </div>
      <div class="modal-footer">
				<button type="submit" class="btn btn-success" onclick="savedata()"><?php echo $this->getCatalog('save')?></button>
        <button type="button" class="btn btn-default" data-dismiss="modal"><?php echo $this->getCatalog('close')?></button>
      </div>
    </div>
  </div>
</div>

<div id="ShowDetailDialog" class="modal fade" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
				<div class="modal-body">
			<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title"><?php echo $this->getCatalog('packagedetail')?></h3>
		<div class="box-tools pull-right">
			<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
		</div>
	</div><!-- /.box-header -->		
<div class="box-body">
				<?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataProviderpackagedetail,
		'id'=>'DetailpackagedetailList',
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
					'header'=>$this->getCatalog('packagedetailid'),
					'name'=>'packagedetailid',
					'value'=>'$data["packagedetailid"]'
				),
							array(
					'header'=>$this->getCatalog('product'),
					'name'=>'productid',
					'value'=>'$data["productname"]'
				),
							array(
					'header'=>$this->getCatalog('qty'),
					'name'=>'qty',
					'value'=>'Yii::app()->format->formatNumber($data["qty"])'
				),
							array(
					'header'=>$this->getCatalog('unitofmeasure'),
					'name'=>'unitofmeasureid',
					'value'=>'$data["uomcode"]'
				),
							array(
					'header'=>$this->getCatalog('price'),
					'name'=>'price',
					'value'=>'Yii::app()->format->formatNumber($data["price"])'
				),
                 			array(
                	'class'=>'CCheckBoxColumn',
                	'name'=>'isbonus',
                	'header'=>$this->getCatalog('isbonus?'),
                	'selectableRows'=>'0',
                	'checked'=>'$data["isbonus"]',
                ),			
		)
));?>
		</div>		
		</div>		
				<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title"><?php echo $this->getCatalog('packagedisc')?></h3>
		<div class="box-tools pull-right">
			<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
		</div>
	</div><!-- /.box-header -->		
<div class="box-body">
				<?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataProviderpackagedisc,
		'id'=>'DetailpackagediscList',
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
					'header'=>$this->getCatalog('packagediscid'),
					'name'=>'packagediscid',
					'value'=>'$data["packagediscid"]'
				),
							array(
					'header'=>$this->getCatalog('discvalue'),
					'name'=>'discvalue',
					'value'=>'Yii::app()->format->formatNumber($data["discvalue"])'
				),
							
		)
));?>
		</div>		
		</div>		
				
			</div>
			</div>
			</div>
			</div>

<div id="ShowDetailDataDialog" class="modal fade" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
				<div class="modal-body">
			<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title"><?php echo $this->getCatalog('company')?></h3>
		<div class="box-tools pull-right">
			<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
		</div>
	</div><!-- /.box-header -->		
<div class="box-body">
				<?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataCompany,
		'id'=>'DetailcompanyList',
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
					'header'=>$this->getCatalog('companyid'),
					'name'=>'companyid',
					'value'=>'$data["companyid"]'
				),
							array(
					'header'=>$this->getCatalog('companyname'),
					'name'=>'companyname',
					'value'=>'$data["companyname"]'
				),		
		)
));?>
		</div>		
		</div>		
				<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title"><?php echo $this->getCatalog('customer')?></h3>
		<div class="box-tools pull-right">
			<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
		</div>
	</div><!-- /.box-header -->		
<div class="box-body">
				<?php
	$this->widget('zii.widgets.grid.CGridView', array(
    'dataProvider'=>$dataCustomer,
		'id'=>'DetailcustomerList',
    'ajaxUpdate'=>true,
		'filter'=>null,
		'enableSorting'=>true,
		'columns'=>array(
			array(
					'header'=>$this->getCatalog('addressbookid'),
					'name'=>'customerid',
					'value'=>'$data["customerid"]'
				),
							array(
					'header'=>$this->getCatalog('fullname'),
					'name'=>'fullname',
					'value'=>'$data["fullname"]'
				),
							array(
					'header'=>$this->getCatalog('salesarea'),
					'name'=>'areaname',
					'value'=>'$data["areaname"]'
				),			
							array(
					'header'=>$this->getCatalog('groupcustomer'),
					'name'=>'groupname',
					'value'=>'$data["groupname"]'
				),
							array(
					'header'=>$this->getCatalog('custgrade'),
					'name'=>'gradedesc',
					'value'=>'$data["gradedesc"]'
				),
							
		)
));?>
		</div>		
		</div>		
				
			</div>
			</div>
			</div>
			</div>
			
<div id="InputDialogpackagedetail" class="modal fade" role="dialog">
	<div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><?php echo $this->getCatalog('packagedetail') ?></h4>
      </div>
			<div class="modal-body">
			<input type="hidden" class="form-control" name="packagedetail_1_packagedetailid">
        <?php $this->widget('DataPopUp',
					array('id'=>'Widget','IDField'=>'packagedetail_1_productid','ColField'=>'packagedetail_1_productname',
						'IDDialog'=>'packagedetail_1_productid_dialog','titledialog'=>$this->getCatalog('product'),'classtype'=>'col-md-4',
						'classtypebox'=>'col-md-8',
						'PopUpName'=>'common.components.views.ProductPopUp','PopGrid'=>'packagedetail_1_productidgrid',
						'onaftersign'=>'getproductdata()')); 
				?>
							
        <div class="row">
						<div class="col-md-4">
							<label for="packagedetail_1_qty"><?php echo $this->getCatalog('qty')?></label>
						</div>
						<div class="col-md-8">
							<input type="number" class="form-control" name="packagedetail_1_qty">
						</div>
					</div>
							
        <?php $this->widget('DataPopUp',
					array('id'=>'Widget','IDField'=>'packagedetail_1_unitofmeasureid','ColField'=>'packagedetail_1_uomcode',
						'IDDialog'=>'packagedetail_1_unitofmeasureid_dialog','titledialog'=>$this->getCatalog('uom'),'classtype'=>'col-md-4',
						'classtypebox'=>'col-md-8','RelationID'=>'productid',
						'PopUpName'=>'common.components.views.UomPlantPopUp','PopGrid'=>'packagedetail_1_unitofmeasureidgrid','onaftersign'=>'getprice();')); 
				?>
							
        <div class="row">
            <div class="col-md-4">
                <label for="packagedetail_1_price"><?php echo $this->getCatalog('price')?></label>
            </div>
            <div class="col-md-8">
                <input type="number" class="form-control" name="packagedetail_1_price">
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <label for="packagedetail_1_isbonus"><?php echo $this->getCatalog('isbonus?')?></label>
            </div>
            <div class="col-md-8">
                <input type="checkbox" name="packagedetail_1_isbonus">
            </div>
        </div>
							
			</div>
			      <div class="modal-footer">
				<button type="submit" class="btn btn-success" onclick="savedatapackagedetail()"><?php echo $this->getCatalog('save') ?></button>
        <button type="button" class="btn btn-default" data-dismiss="modal"><?php echo $this->getCatalog('close') ?></button>
      </div>
			</div>
			</div>
			</div>
			<div id="InputDialogpackagedisc" class="modal fade" role="dialog">
	<div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><?php echo $this->getCatalog('packagedisc') ?></h4>
      </div>
			<div class="modal-body">
			<input type="hidden" class="form-control" name="packagedisc_2_packagediscid">
        <div class="row">
						<div class="col-md-4">
							<label for="packagedisc_2_discvalue"><?php echo $this->getCatalog('discvalue')?></label>
						</div>
						<div class="col-md-8">
							<input type="number" class="form-control" name="packagedisc_2_discvalue">
						</div>
					</div>
							
			</div>
			      <div class="modal-footer">
				<button type="submit" class="btn btn-success" onclick="savedatapackagedisc()"><?php echo $this->getCatalog('save') ?></button>
        <button type="button" class="btn btn-default" data-dismiss="modal"><?php echo $this->getCatalog('close') ?></button>
      </div>
			</div>
			</div>
			</div>
			